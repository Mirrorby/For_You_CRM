<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Äî For You CRM</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background-color: #f9f9f9;
      max-width: 600px;
      margin: auto;
    }

    h2, h3 {
      text-align: center;
      margin-top: 0;
    }

    .page label {
      font-weight: 600;
      margin-top: 1rem;
      display: block;
    }

    .page input,
    .page select,
    .page textarea {
      width: 100%;
      font-size: 1rem;
      padding: 0.5rem;
      margin-top: 0.25rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .add-product,
    .submit-order {
      width: 100%;
      font-size: 1.1rem;
      padding: 0.75rem;
      margin-top: 1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }

    .add-product {
      background-color: #007bff;
      color: #fff;
    }

    .submit-order {
      background-color: #28a745;
      color: white;
    }
  </style>
</head>
<body>

<div class="nav-bar">
  <button onclick="goHome()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
</div>

  <div id="new-order" class="page">
    <h2>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>

    <!-- –ö–ª–∏–µ–Ω—Ç -->
    <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
    <input type="text" id="clientName" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>

    <label>–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</label>
    <input type="tel" id="clientPhone" placeholder="+7..." required>

    <label>–°–ø–æ—Å–æ–± —Å–≤—è–∑–∏</label>
    <select id="contactMethod" required>
      <option value="">–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–±</option>
      <option>Telegram</option>
      <option>WhatsApp</option>
    </select>

    <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
    <textarea id="clientAddress" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å" required></textarea>

    <!-- –ü—Ä–æ–¥–∞–∂–∏ –∏ –ª–æ–≥–∏—Å—Ç–∏–∫–∞ -->
    <label>–ö–∞–Ω–∞–ª –ø—Ä–æ–¥–∞–∂</label>
    <select id="channel" required>
      <option value="">–í—ã–±–µ—Ä–∏ –∫–∞–Ω–∞–ª</option>
      <option>–¢–µ–ª–µ–≥—Ä–∞–º</option>
      <option>WKO</option>
      <option>–ê–≤-1</option>
      <option>–ê–≤-2</option>
      <option>–¢–ì –ü–æ—Å—Ç–æ—è–Ω–Ω–∏–∫</option>
      <option>–í–∏–∫–µ–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–∏–∫</option>
      <option>–ü–æ—Å—Ç–æ—è–Ω–Ω–∏–∫</option>
      <option>–î—Ä–æ–ø–µ—Ä</option>
      <option>%</option>
    </select>

    <label>–õ–æ–≥–∏—Å—Ç–∏–∫–∞</label>
    <select id="deliveryService" required>
      <option value="">–í—ã–±–µ—Ä–∏ –ª–æ–≥–∏—Å—Ç–∏–∫—É</option>
      <option>–°–î–ï–ö</option>
      <option>–ê–≤–∏—Ç–æ –°–î–ï–ö</option>
      <option>–ê–≤–∏—Ç–æ –ü–æ—á—Ç–∞ –†–§</option>
      <option>–ê–≤–∏—Ç–æ Boxberry</option>
      <option>–ü–æ—á—Ç–∞ –†–§</option>
      <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
      <option>–î–æ—Å—Ç–∞–≤–∏—Å—Ç–∞</option>
      <option>–Ø–Ω–¥–µ–∫—Å</option>
      <option>x EXMAIL</option>
      <option>Boxberry</option>
      <option>–ê–≤–∏—Ç–æ –Ø–Ω–¥–µ–∫—Å</option>
      <option>–ù–∞—à –∫—É—Ä—å–µ—Ä</option>
      <option>JDE</option>
      <option>–ê–≤–∏—Ç–æ –°–±–µ—Ä–ª–æ–≥–∏—Å—Ç–∏–∫–∞</option>
      <option>–ê–≤–∏—Ç–æ DPD</option>
      <option>–ú–µ–≥–∞—Ç—Ä–∞–Ω—Å</option>
      <option>–ú—ç–¥–∂–∏–∫–¢—Ä–∞–Ω—Å</option>
      <option>–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏</option>
      <option>–ö–ò–¢</option>
      <option>–ü–≠–ö</option>
      <option>–≠–Ω–µ—Ä–≥–∏—è</option>
      <option>5POST</option>
      <option>–ö–°–ï</option>
      <option>–ë–∞–π–∫–∞–ª</option>
    </select>

    <label>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</label>
    <input type="date" id="orderDate" required>

    <!-- –¢–æ–≤–∞—Ä—ã -->
    <h3>–¢–æ–≤–∞—Ä—ã</h3>
    <div id="productList"></div>
    <button class="add-product" onclick="addProduct()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

    <button class="submit-order" onclick="submitOrder()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <script src="script.js"></script>
<script>
  function addProduct() {
    const list = document.getElementById("productList");
    const wrapper = document.createElement("div");
    wrapper.classList.add("product-item");
    wrapper.innerHTML = `
      <input type="text" placeholder="–ê—Ä—Ç–∏–∫—É–ª" class="article" required>
      <input type="number" placeholder="–ö–æ–ª-–≤–æ" class="count" required>
      <input type="number" placeholder="–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (‚ÇΩ)" class="orderSum">
      <input type="number" placeholder="–°—É–º–º–∞ –∑–∞–∫—É–ø–∞ (‚ÇΩ)" class="purchaseSum">
      <input type="text" placeholder="‚Ññ –∑–∞–∫–∞–∑–∞ (—Ç–æ–≤–∞—Ä–∞)" class="orderNumber">
      <input type="text" placeholder="–¢—Ä–µ–∫-–Ω–æ–º–µ—Ä" class="trackNumber">
      <select class="supplier">
        <option value="">–°–∫–ª–∞–¥ / –ø–æ—Å—Ç–∞–≤—â–∏–∫</option>
        <option>–£ –ê—Ä—É—Ç–∞</option>
        <option>–ú–æ–π —Å–∫–ª–∞–¥</option>
        <option>–ü–æ—Å-Y1 —Å–∫–ª–∞–¥</option>
        <option>–ü–æ—Å-Y2 —Å–∫–ª–∞–¥</option>
        <option>–ß–µ—Ä–µ–∑ –°–∞—Ö–∏</option>
      </select>
    `;
    list.appendChild(wrapper);
  }

  async function submitOrder() {
    const data = {
      name: document.getElementById("clientName").value,
      phone: document.getElementById("clientPhone").value,
      address: document.getElementById("clientAddress").value,
      channel: document.getElementById("channel").value,
      logistics: document.getElementById("deliveryService").value,
      orderDate: document.getElementById("orderDate").value,
      comment: document.getElementById("orderComment").value,
      products: []
    };

    document.querySelectorAll(".product-item").forEach(el => {
      data.products.push({
        article: el.querySelector(".article")?.value || "",
        count: el.querySelector(".count")?.value || "",
        orderSum: el.querySelector(".orderSum")?.value || "",
        purchaseSum: el.querySelector(".purchaseSum")?.value || "",
        orderNumber: el.querySelector(".orderNumber")?.value || "",
        trackNumber: el.querySelector(".trackNumber")?.value || "",
        supplier: el.querySelector(".supplier")?.value || ""
      });
    });

    try {
      const response = await submitOrderData(data);
      if (response.result === "ok") {
        alert(`‚úÖ –ó–∞–∫–∞–∑ ‚Ññ${response.id} —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω`);
        window.location.href = "index.html";
      } else {
        throw new Error("–û—à–∏–±–∫–∞ –≤ –æ—Ç–≤–µ—Ç–µ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞");
      }
    } catch (e) {
      alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞");
      console.error(e);
    }
  }
</script>


</body>
</html>
