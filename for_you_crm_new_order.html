<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Äî For You CRM</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
      background-color: #f9f9f9;
      max-width: 600px;
      margin: auto;
    }
    h2, h3 {
      text-align: center;
      margin-top: 0;
    }
    label {
      font-weight: 600;
      margin-top: 1rem;
      display: block;
    }
    input, select, textarea {
      width: 100%;
      font-size: 1rem;
      padding: 0.5rem;
      margin-top: 0.25rem;
      margin-bottom: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }
    .add-product, .submit-order {
      width: 100%;
      font-size: 1.1rem;
      padding: 0.75rem;
      margin-top: 1rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    .add-product {
      background-color: #007bff;
      color: #fff;
    }
    .submit-order {
      background-color: #28a745;
      color: white;
    }
    .nav-bar {
      position: fixed;
      top: 0.75rem;
      left: 0.75rem;
      z-index: 100;
    }
    .nav-bar button {
      font-size: 1rem;
      padding: 0.5rem 0.8rem;
      border-radius: 6px;
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="page">
    <h2>–ù–æ–≤—ã–π –∑–∞–∫–∞–∑</h2>
    <label>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
    <input type="text" id="clientName" required>

    <label>–¢–µ–ª–µ—Ñ–æ–Ω –∫–ª–∏–µ–Ω—Ç–∞</label>
    <input type="tel" id="clientPhone" required>

    <label>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
    <textarea id="clientAddress" required></textarea>

    <label>–ö–∞–Ω–∞–ª –ø—Ä–æ–¥–∞–∂</label>
    <select id="channel" required>
      <option value="">–í—ã–±–µ—Ä–∏ –∫–∞–Ω–∞–ª</option>
      <option>–¢–µ–ª–µ–≥—Ä–∞–º</option>
      <option>WKO</option>
      <option>–ê–≤-1</option>
      <option>–ê–≤-2</option>
      <option>–¢–ì –ü–æ—Å—Ç–æ—è–Ω–Ω–∏–∫</option>
      <option>–í–∏–∫–µ–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–∏–∫</option>
      <option>–ü–æ—Å—Ç–æ—è–Ω–Ω–∏–∫</option>
      <option>–î—Ä–æ–ø–µ—Ä</option>
      <option>%</option>
    </select>

    <label>–õ–æ–≥–∏—Å—Ç–∏–∫–∞</label>
    <select id="deliveryService" required>
      <option value="">–í—ã–±–µ—Ä–∏ –ª–æ–≥–∏—Å—Ç–∏–∫—É</option>
      <option>–°–î–ï–ö</option>
      <option>–ê–≤–∏—Ç–æ –°–î–ï–ö</option>
      <option>–ê–≤–∏—Ç–æ –ü–æ—á—Ç–∞ –†–§</option>
      <option>–ê–≤–∏—Ç–æ Boxberry</option>
      <option>–ü–æ—á—Ç–∞ –†–§</option>
      <option>–°–∞–º–æ–≤—ã–≤–æ–∑</option>
      <option>–î–æ—Å—Ç–∞–≤–∏—Å—Ç–∞</option>
      <option>–Ø–Ω–¥–µ–∫—Å</option>
      <option>x EXMAIL</option>
      <option>Boxberry</option>
      <option>–ê–≤–∏—Ç–æ –Ø–Ω–¥–µ–∫—Å</option>
      <option>–ù–∞—à –∫—É—Ä—å–µ—Ä</option>
      <option>JDE</option>
      <option>–ê–≤–∏—Ç–æ –°–±–µ—Ä–ª–æ–≥–∏—Å—Ç–∏–∫–∞</option>
      <option>–ê–≤–∏—Ç–æ DPD</option>
      <option>–ú–µ–≥–∞—Ç—Ä–∞–Ω—Å</option>
      <option>–ú—ç–¥–∂–∏–∫–¢—Ä–∞–Ω—Å</option>
      <option>–î–µ–ª–æ–≤—ã–µ –õ–∏–Ω–∏–∏</option>
      <option>–ö–ò–¢</option>
      <option>–ü–≠–ö</option>
      <option>–≠–Ω–µ—Ä–≥–∏—è</option>
      <option>5POST</option>
      <option>–ö–°–ï</option>
      <option>–ë–∞–π–∫–∞–ª</option>
    </select>

    <label>–î–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</label>
    <input type="date" id="orderDate" required>

    <h3>–¢–æ–≤–∞—Ä—ã</h3>
    <div id="productList"></div>
    <button class="add-product" onclick="addProduct()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>

    <button class="submit-order" onclick="submitOrder()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/library/d/1vQ2CozRviGNxMFzNruih0kP7VNFXNKT2diUecs4060TEsK2yYntg4cAi/2";

    function submitOrderData(data) {
      return fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      }).then(res => res.json());
    }

    function addProduct() {
      const list = document.getElementById("productList");
      const index = list.children.length + 1;

      const wrapper = document.createElement("div");
      wrapper.classList.add("product-item");
      wrapper.style.marginBottom = "1rem";
      wrapper.innerHTML = `
        <h4>–¢–æ–≤–∞—Ä ‚Ññ${index}</h4>
        <label>–ê—Ä—Ç–∏–∫—É–ª</label>
        <input type="text" class="article" required>
        <label>–ö–æ–ª-–≤–æ</label>
        <input type="number" class="count" required>
        <label>–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ (‚ÇΩ)</label>
        <input type="number" class="orderSum">
        <label>–°—É–º–º–∞ –∑–∞–∫—É–ø–∞ (‚ÇΩ)</label>
        <input type="number" class="purchaseSum">
        <label>–°–∫–ª–∞–¥ / –ø–æ—Å—Ç–∞–≤—â–∏–∫</label>
        <select class="supplier">
          <option value="">–í—ã–±–µ—Ä–∏</option>
          
<option>–£ –ê—Ä—É—Ç–∞</option>
<option>–ú–æ–π —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-Y1 —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-Y2 —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-Y30 —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-S1 —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-S2 —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-K1 —Å–∫–ª–∞–¥</option>
<option>–ü–æ—Å-Y1</option>
<option>–ü–æ—Å-Y2</option>
<option>–ü–æ—Å-Y3</option>
<option>–ü–æ—Å-Y4</option>
<option>–ü–æ—Å-Y5</option>
<option>–ü–æ—Å-Y6</option>
<option>–ü–æ—Å-Y7</option>
<option>–ü–æ—Å-Y8</option>
<option>–ü–æ—Å-Y9</option>
<option>–ü–æ—Å-Y10</option>
<option>–ü–æ—Å-Y11</option>
<option>–ü–æ—Å-Y12</option>
<option>–ü–æ—Å-Y20</option>
<option>–ü–æ—Å-Y31</option>
<option>–ü–æ—Å—Ç-Y30</option>
<option>–ü–æ—Å-Y13</option>
<option>–ü–æ—Å—Ç-Y15</option>
<option>–ü–æ—Å—Ç-Y14</option>
<option>–ü–æ—Å—Ç-17</option>
<option>–ß–µ—Ä–µ–∑ –°–∞—Ö–∏</option>

        </select>
        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ç–æ–≤–∞—Ä—É</label>
        <textarea class="productComment"></textarea>
        <label>–§–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞</label>
        <input type="file" class="productPhoto">
      `;
      list.appendChild(wrapper);
    }

    async function submitOrder() {
      const data = {
        clientName: document.getElementById("clientName").value,
        clientPhone: document.getElementById("clientPhone").value,
        clientAddress: document.getElementById("clientAddress").value,
        channel: document.getElementById("channel").value,
        deliveryService: document.getElementById("deliveryService").value,
        orderDate: document.getElementById("orderDate").value,
        products: []
      };

      document.querySelectorAll(".product-item").forEach(el => {
        const photoInput = el.querySelector(".productPhoto");
        const fileName = photoInput?.files?.[0]?.name || "";

        data.products.push({
          article: el.querySelector(".article").value,
          count: el.querySelector(".count").value,
          orderSum: el.querySelector(".orderSum").value,
          purchaseSum: el.querySelector(".purchaseSum").value,
          supplier: el.querySelector(".supplier").value,
          comment: el.querySelector(".productComment").value,
          photo: fileName
        });
      });

      try {
        const res = await submitOrderData(data);
        if (res.result === "ok") {
          alert(`‚úÖ –ó–∞–∫–∞–∑ ‚Ññ${res.id} —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω`);
          window.location.href = "index.html";
        } else {
          alert("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑");
        }
      } catch (err) {
        console.error(err);
        alert("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–∫–∞–∑–∞");
      }
    }

    function goHome() {
      window.location.href = "index.html";
    }
  </script>

  <div class="nav-bar">
    <button onclick="goHome()">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
  </div>
</body>
</html>